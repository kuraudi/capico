{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/askeroff/Desktop/vscode/exchange/frontend/src/app/GlobalContext.tsx"],"sourcesContent":["import { createContext, useContext, useEffect, useState } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nexport type TypeCoinInfo = {\r\n  name: string;\r\n  url_logo: string;\r\n  price?: number;\r\n  price24hPcnt?: number;\r\n  turnover24h?: number;\r\n  volume24h?: number;\r\n  lowPrice24h?: number;\r\n  highPrice24h?: number;\r\n};\r\ntype CoinBalance = {\r\n  symbol: string;\r\n  name: string;\r\n  url_logo: string;\r\n  total_balance: number;\r\n  avaliable_balance: number;\r\n  reserved_balance: number;\r\n  breakeven_price: number;\r\n  total_pnl: number;\r\n};\r\n\r\ntype TypeCoinName = [string, { name: string; logo: string }];\r\ntype TypeTotalBalance = { totalBalanceUSD: number; totalBalanceBTC: number };\r\n\r\ninterface GlobalContextType {\r\n  role: string;\r\n  coinPrices: [string, TypeCoinInfo][];\r\n  userCoinsBalances: CoinBalance[]; // Массив массивов\r\n  setRole: (role: string) => void;\r\n  totalBalance: TypeTotalBalance;\r\n  userInfo: TypeUserInfo;\r\n}\r\ntype TypeUserInfo = {\r\n  email: string;\r\n};\r\n\r\nconst GlobalContext = createContext<GlobalContextType | undefined>(undefined);\r\n\r\nexport const RoleProvider = ({ children }: { children: React.ReactNode }) => {\r\n  const [role, setRole] = useState<string>(\"guest\");\r\n  const [userInfo, setUserInfo] = useState<TypeUserInfo>({\r\n    email: \"\",\r\n  });\r\n  const [coinPrices, setCoinPrices] = useState<[string, TypeCoinInfo][]>([]);\r\n  const [totalBalance, setTotalBalance] = useState<{\r\n    totalBalanceUSD: number;\r\n    totalBalanceBTC: number;\r\n  }>({ totalBalanceUSD: 0, totalBalanceBTC: 0 });\r\n\r\n  useEffect(() => {\r\n    const savedRole = localStorage.getItem(\"role\");\r\n    setRole(savedRole || \"guest\");\r\n    if (!savedRole) localStorage.setItem(\"role\", \"guest\");\r\n\r\n    // 📌 Загрузка списка монет из БД\r\n    const fetchCoins = async () => {\r\n      try {\r\n        const { data: coins } = await axios.get<TypeCoinName[]>(\r\n          \"http://127.0.0.1:8000/market\"\r\n        );\r\n\r\n        // const { data: metaInfo } = await axios.get(\r\n        //   \"http://127.0.0.1:8000/market/metainfo\"\r\n        // );\r\n\r\n        // 📌 Преобразуем данные в массив массивов\r\n        const updatedPrices: [string, TypeCoinInfo][] = coins.map((coin) => [\r\n          coin[0],\r\n          {\r\n            name: coin[1].name,\r\n            url_logo: coin[1].logo,\r\n            price: 0,\r\n            price24hPcnt: 0,\r\n            turnover24h: 0,\r\n            lowPrice24h: 0,\r\n            highPrice24h: 0,\r\n            volume24h: 0,\r\n          },\r\n        ]);\r\n        setCoinPrices(updatedPrices);\r\n      } catch (error) {\r\n        console.error(\"❌ Ошибка загрузки монет:\", error);\r\n      }\r\n    };\r\n\r\n    // 🔄 Функция для обновления цен из Redis\r\n    const updatePriceFromRedis = async () => {\r\n      try {\r\n        const { data: response } = await axios.get<\r\n          [string, Partial<TypeCoinInfo>][]\r\n        >(\"http://127.0.0.1:8000/market/prices\");\r\n\r\n        // console.log(\"💰 Обновленные цены:\", response);\r\n\r\n        setCoinPrices((prev) => {\r\n          const updated = prev.map(([symbol, coin]) => {\r\n            const found = response.find((el) => el[0] === symbol);\r\n            return [symbol, { ...coin, ...(found ? found[1] : {}) }] as [\r\n              string,\r\n              TypeCoinInfo\r\n            ]; // 🔥 Тут явно указываем тип\r\n          });\r\n\r\n          // 📌 Сортируем по цене (по убыванию)\r\n          return updated.sort((a, b) => (b[1].price ?? 0) - (a[1].price ?? 0));\r\n        });\r\n      } catch (error) {\r\n        console.error(\"❌ Ошибка загрузки цен из Redis:\", error);\r\n      }\r\n    };\r\n\r\n    fetchCoins();\r\n    updatePriceFromRedis();\r\n    const interval = setInterval(updatePriceFromRedis, 3000);\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  const [userCoinsBalances, setUserCoinBalances] = useState<CoinBalance[]>([]);\r\n  useEffect(() => {\r\n    const fetchUserBalances = async () => {\r\n      try {\r\n        const response = await axios.get(\r\n          \"http://127.0.0.1:8000/market/user-balances\",\r\n          {\r\n            headers: {\r\n              Authorization: `Bearer ${localStorage.getItem(\"access\")}`,\r\n            },\r\n          }\r\n        );\r\n        console.log(response.data, \"ai\");\r\n\r\n        setUserCoinBalances(response.data);\r\n      } catch (error) {\r\n        console.error(\"Ошибка при получении баланса:\", error);\r\n      }\r\n    };\r\n    const fetchTotalBalance = async () => {\r\n      try {\r\n        const response = await axios.get(\"http://127.0.0.1:8000/market/test\", {\r\n          headers: {\r\n            Authorization: `Bearer ${localStorage.getItem(\"access\")}`,\r\n          },\r\n        });\r\n        setTotalBalance(() => ({\r\n          totalBalanceUSD: response.data.total_balance ?? 0,\r\n          totalBalanceBTC: response.data.total_balance_btc ?? 0,\r\n        }));\r\n      } catch (error) {\r\n        console.error(\"Ошибка при получении баланса:\", error);\r\n      }\r\n    };\r\n    // Вызов функции\r\n    fetchUserBalances();\r\n    fetchTotalBalance();\r\n    setUserInfo((prev) => ({\r\n      ...prev,\r\n      email: localStorage.getItem(\"email\") ?? \"\",\r\n    }));\r\n  }, []);\r\n\r\n  const updateRole = (newRole: string) => {\r\n    setRole(newRole);\r\n    localStorage.setItem(\"role\", newRole);\r\n  };\r\n\r\n  return (\r\n    <GlobalContext.Provider\r\n      value={{\r\n        role,\r\n        setRole: updateRole,\r\n        coinPrices,\r\n        userCoinsBalances,\r\n        totalBalance,\r\n        userInfo,\r\n      }}\r\n    >\r\n      {children}\r\n    </GlobalContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useGlobalContext = () => {\r\n  const context = useContext(GlobalContext);\r\n  if (!context) {\r\n    throw new Error(\"useRole must be used within a RoleProvider\");\r\n  }\r\n  return context;\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 190, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 196, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/askeroff/Desktop/vscode/exchange/frontend/src/app/layout.tsx"],"sourcesContent":["\"use client\";\nimport \"./globals.css\";\nimport \"./resets.css\";\nimport { RoleProvider } from \"./GlobalContext\";\n\nexport default function RootLayout({\n  children,\n}: Readonly<{\n  children: React.ReactNode;\n}>) {\n  return (\n    <html lang=\"en\">\n      <head></head>\n      <RoleProvider>\n        <body>{children}</body>\n      </RoleProvider>\n    </html>\n  );\n}\n"],"names":[],"mappings":";;;;AAGA;AAHA;;;;;AAKe,SAAS,WAAW,EACjC,QAAQ,EAGR;IACA,qBACE,6LAAC;QAAK,MAAK;;0BACT,6LAAC;;;;;0BACD,6LAAC,+HAAA,CAAA,eAAY;0BACX,cAAA,6LAAC;8BAAM;;;;;;;;;;;;;;;;;AAIf;KAbwB"}},
    {"offset": {"line": 241, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}